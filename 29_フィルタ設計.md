以下のように、周波数領域の伝達関数から時刻領域の２次常微分方程式を導きます。

---

## 1. 伝達関数の定義

2次バターワース・ローパスフィルタの伝達関数を

$$
H(s)=\frac{Y(s)}{X(s)}
=\frac{\omega_0^2}{s^2 + \sqrt2\,\omega_0\,s + \omega_0^2}
$$

とします。ここで

* $X(s)$ は入力 $x(t)$ のラプラス変換
* $Y(s)$ は出力 $y(t)$ のラプラス変換
* $\omega_0$ はカットオフ角周波数

---

## 2. 両辺を分母で掛け合わせ

$$
Y(s)
= H(s)\,X(s)
\;\Longrightarrow\;
\bigl(s^2 + \sqrt2\,\omega_0\,s + \omega_0^2\bigr)\,Y(s)
= \omega_0^2\,X(s).
$$

---

## 3. ラプラス演算子 $s$ と時域微分の対応

ラプラス変換の性質より、

$$
\mathcal{L}\{y'(t)\}=s\,Y(s)-y(0^-),\quad
\mathcal{L}\{y''(t)\}=s^2\,Y(s)-s\,y(0^-)-y'(0^-).
$$

ここでは初期条件 $y(0^-)=y'(0^-)=0$ と仮定して簡単化すると、

$$
\mathcal{L}\{y'(t)\}\approx s\,Y(s),\quad
\mathcal{L}\{y''(t)\}\approx s^2\,Y(s).
$$

---

## 4. 逆ラプラス変換して時刻領域方程式に

$$
\bigl(s^2 + \sqrt2\,\omega_0\,s + \omega_0^2\bigr)\,Y(s)
= \omega_0^2\,X(s)
$$

を逆ラプラス変換すると、

$$
\mathcal{L}^{-1}\{s^2Y(s)\}
\;+\;\sqrt2\,\omega_0\,\mathcal{L}^{-1}\{sY(s)\}
\;+\;\omega_0^2\,\mathcal{L}^{-1}\{Y(s)\}
\;=\;\omega_0^2\,\mathcal{L}^{-1}\{X(s)\}.
$$

すなわち

$$
y''(t)
\;+\;\sqrt2\,\omega_0\,y'(t)
\;+\;\omega_0^2\,y(t)
\;=\;\omega_0^2\,x(t).
$$

これが求める**２次常微分方程式**です。

---

### 最終形

$$
\boxed{
y''(t)
\;+\;\sqrt2\,\omega_0\,y'(t)
\;+\;\omega_0^2\,y(t)
\;=\;\omega_0^2\,x(t)
}
$$

* 左辺は「フィルタ出力の２階＋１階＋０階微分の線形結合」
* 右辺は「カットオフ周波数の２乗かける入力」

これにより、伝達関数 $H(s)$ と同等の時刻領域モデルが得られました。



以下、アナログの２次バターワースローパスフィルタの微分方程式から始めて、**有限差分を用いた完全手計算**で、最終的に

$$
y[n]
= y[n-1]
\;+\;
\frac{(\omega_c\Delta t)^2}{D}
\,\bigl(x[n]-y[n-1]\bigr)
\;+\;
\frac{1}{D}
\,\bigl(y[n-1]-y[n-2]\bigr)
\quad\bigl(D=1+\sqrt2\,\omega_c\Delta t+(\omega_c\Delta t)^2\bigr)
$$

という「増分形式（インクリメンタルフォーム）」を得るまでを、飛ばさずに解説します。

---

## 1. アナログ微分方程式を書き下す

2次バターワースローパスは次の２次常微分方程式で表されます（入力を $x(t)$、出力を $y(t)$）：

$$
\underbrace{\frac{d^2y}{dt^2}}_{\displaystyle y''}
\;+\;\sqrt2\,\omega_c\,\underbrace{\frac{dy}{dt}}_{\displaystyle y'}
\;+\;\omega_c^2\,y
\;=\;\omega_c^2\,x
\tag{1}
$$

* $\omega_c$：カットオフ角周波数 \[rad/s]
* $\sqrt2$：2次バターワース特有の係数

---

## 2. 時間離散化：差分近似

サンプリング周期を $\Delta t$ とし、$t=n\Delta t$ における信号を

$$
y[n] = y(n\Delta t),\quad x[n] = x(n\Delta t)
$$

で表すと、微分を以下の「後退差分」で近似できます：

$$
\begin{aligned}
y'(n\Delta t)
&\approx \frac{y[n] - y[n-1]}{\Delta t},\\
y''(n\Delta t)
&\approx \frac{\,y[n] - 2\,y[n-1] + y[n-2]\,}{\Delta t^2}.
\end{aligned}
$$

---

## 3. １．の式に差分を代入

(1) の両辺にこれを代入：

$$
\frac{y[n]-2y[n-1]+y[n-2]}{\Delta t^2}
\;+\;\sqrt2\,\omega_c\;\frac{y[n]-y[n-1]}{\Delta t}
\;+\;\omega_c^2\,y[n]
\;=\;\omega_c^2\,x[n].
$$

---

## 4. $\Delta t^2$ を掛けて整理

分母を消すために $\Delta t^2$ を両辺に掛けると、

$$
y[n] - 2y[n-1] + y[n-2]
\;+\;\sqrt2\,\omega_c\,\Delta t\,(y[n]-y[n-1])
\;+\;(\omega_c\Delta t)^2\,y[n]
\;=\;(\omega_c\Delta t)^2\,x[n].
$$

---

## 5. 同じ $y[n]$, $y[n-1]$, $y[n-2]$ 項ごとにまとめる

左辺を $y[n]$、$y[n-1]$、$y[n-2]$ の係数で整理します。まずそれぞれの項を展開：

* **$y[n]$ の係数**

  $$
    1 
    \;+\;\sqrt2\,\omega_c\Delta t
    \;+\;(\omega_c\Delta t)^2
    \;=\;D,
    \quad D \coloneqq 1 + \sqrt2\,c + c^2,\quad c\coloneqq\omega_c\Delta t.
  $$
* **$y[n-1]$ の係数**

  $$
    -2 
    \;-\;\sqrt2\,\omega_c\Delta t
    \;=\;
    -\bigl(2 + \sqrt2\,c\bigr).
  $$
* **$y[n-2]$ の係数**

  $$
    +1.
  $$

右辺は $(\omega_c\Delta t)^2\,x[n]=c^2\,x[n]$。
従って等式は

$$
D\,y[n]
\;-\;(2+\sqrt2\,c)\,y[n-1]
\;+\;1\cdot y[n-2]
\;=\;c^2\,x[n].
$$

---

## 6. $y[n]$ について解く

両辺を $D$ で割って、直接形（ノーマライズ版）にします：

$$
y[n]
= \underbrace{\frac{2+\sqrt2\,c}{D}}_{p_1}\,y[n-1]
\;-\;\underbrace{\frac{1}{D}}_{p_2}\,y[n-2]
\;+\;\underbrace{\frac{c^2}{D}}_{p_3}\,x[n].
\tag{2}
$$

ここで

$$
\begin{aligned}
p_1 &= \frac{2+\sqrt2\,c}{\,1+\sqrt2\,c+c^2\,},\\
p_2 &= \frac{1}{\,1+\sqrt2\,c+c^2\,},\\
p_3 &= \frac{c^2}{\,1+\sqrt2\,c+c^2\,}.
\end{aligned}
$$

式(2) は「2次 IIR フィルタの直接形」です。

---

## 7. 増分（インクリメンタル）形式への書き換え

式(2) から、1 サンプル前との差分を使って書くと、制御実装や組み込みで便利な形になります。

$$
\begin{aligned}
y[n] - y[n-1]
&= \underbrace{p_3}_{\frac{c^2}{D}}\,x[n]
  + \underbrace{p_1}_{\frac{2+\sqrt2 c}{D}}\,y[n-1]
  - \underbrace{p_2}_{\frac{1}{D}}\,y[n-2]
  - y[n-1]\\
&= \frac{c^2}{D}\,x[n]
  + \Bigl(\frac{2+\sqrt2\,c}{D}-1\Bigr)\,y[n-1]
  - \frac{1}{D}\,y[n-2].
\end{aligned}
$$

ただし

$$
\frac{2+\sqrt2\,c}{D}-1
= \frac{2+\sqrt2\,c - (1+\sqrt2\,c+c^2)}{D}
= \frac{1 - c^2}{D}.
$$

したがって

$$
\begin{aligned}
y[n] - y[n-1]
&= \frac{c^2}{D}\,x[n]
  + \frac{1 - c^2}{D}\,y[n-1]
  - \frac{1}{D}\,y[n-2]\\
&= \underbrace{\frac{c^2}{D}}_{\alpha}\,
    \bigl(x[n]-y[n-1]\bigr)
  + \underbrace{\frac{1}{D}}_{\beta}\,
    \bigl(y[n-1]-y[n-2]\bigr).
\end{aligned}
$$

最後に両辺に $y[n-1]$ を足し戻すと、**増分形式** が得られます：

$$
\boxed{
y[n]
= y[n-1]
+ \alpha\,\bigl(x[n]-y[n-1]\bigr)
+ \beta\,\bigl(y[n-1]-y[n-2]\bigr),
}
$$

$$
\text{where}\quad
c = \omega_c\Delta t,\quad
D = 1 + \sqrt2\,c + c^2,
\quad
\alpha = \frac{c^2}{D},\quad
\beta = \frac{1}{D}.
$$

---

### まとめ

1. **アナログ微分方程式**
   $\;y'' + \sqrt2\,\omega_c\,y' + \omega_c^2 y = \omega_c^2 x\;$ をスタート。
2. **差分近似**
   $\;y' \approx (y[n]-y[n-1])/\Delta t,\; y''\approx(y[n]-2y[n-1]+y[n-2])/\Delta t^2\;$。
3. **整理～正規化**
   項をまとめて $y[n]$ について解き、係数を $D,\,p_1,p_2,p_3$ に整理。
4. **増分形式**
   差分 $y[n]-y[n-1]$ を使うことで、組み込み実装に向く形に書き換え。

これで、**「2次バターワースローパス」を離散時間で動かすための差分方程式**が完全に理解できるはずです。
