# １．前処理（プリプロセッサ）
前処理（プリプロセッサ）やディレクティブについて詳しく説明します。

### 前処理（プリプロセッサ）とは

前処理（プリプロセッサ）は、CやC++プログラムのソースコードがコンパイルされる前に実行される一連の指示や処理のことです。プリプロセッサは、ソースコード内の特定の命令（ディレクティブ）に基づいてコードの変換や修正を行います。

### プリプロセッサの役割

1. **マクロの置換**: 定義されたマクロを展開して、コード内の特定の部分を置換します。
2. **ファイルのインクルード**: 外部ファイルの内容を現在のソースファイルに挿入します。
3. **条件付きコンパイル**: 特定の条件に基づいて、コードの一部をコンパイルするかどうかを決定します。
4. **エラーチェック**: プログラムの特定の条件が満たされない場合にエラーメッセージを出力します。

### ディレクティブとは

ディレクティブは、プリプロセッサに対する命令です。ディレクティブは常に`#`（シャープ）記号で始まり、その後に命令が続きます。ディレクティブはコンパイラに渡される前にプリプロセッサによって処理されます。

### 主要なプリプロセッサディレクティブ

以下に、主要なプリプロセッサディレクティブとその役割を簡単に説明します。

1. **#define**
   - マクロを定義します。例えば、定数や関数のようなコード片を定義できます。

   ```c
   #define PI 3.14
   #define SQUARE(x) ((x) * (x))
   ```

2. **#undef**
   - 以前に定義されたマクロを未定義にします。

   ```c
   #undef PI
   ```

3. **#include**
   - 外部のヘッダーファイルやソースファイルを現在のファイルに挿入します。

   ```c
   #include <stdio.h>
   #include "myheader.h"
   ```

4. **#if、#elif、#else、#endif**
   - 条件付きコンパイルを行います。特定の条件が満たされた場合にのみ、コードの一部をコンパイルします。

   ```c
   #if CONDITION
   // 条件が真の場合
   #elif ANOTHER_CONDITION
   // 別の条件が真の場合
   #else
   // どの条件も満たされない場合
   #endif
   ```

5. **#ifdef、#ifndef、#endif**
   - マクロが定義されているかどうかをチェックして、条件付きコンパイルを行います。

   ```c
   #ifdef DEBUG
   // DEBUGが定義されている場合
   #else
   // DEBUGが定義されていない場合
   #endif
   ```

6. **#error**
   - プリプロセッサがエラーメッセージを出力し、コンパイルを停止します。

   ```c
   #error "このコードはこのコンパイラではサポートされていません"
   ```

7. **#pragma**
   - コンパイラに特定の命令を与えます。内容はコンパイラ依存です。

   ```c
   #pragma once  // ヘッダーファイルの重複インクルードを防ぐ
   ```

8. **#line**
   - ソースコードの行番号やファイル名を設定します。

   ```c
   #line 100 "newfile.c"
   ```

### プリプロセッサの動作例

以下の簡単な例を見てみましょう。

```c
#define MAX 100

#if MAX > 50
    #include <stdio.h>
#endif

int main() {
    #ifdef MAX
        printf("MAX is defined and its value is %d\n", MAX);
    #else
        printf("MAX is not defined.\n");
    #endif
    return 0;
}
```

このコードでは、`MAX`が50より大きいため、`#include <stdio.h>`が有効になります。また、`MAX`が定義されているため、`printf`文がコンパイルされます。

プリプロセッサは、コードの柔軟性や移植性を高めるための強力なツールです。条件付きコンパイルを使用することで、異なる環境や設定に応じたコードを簡単に切り替えることができます。
